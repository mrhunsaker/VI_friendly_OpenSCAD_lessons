$passoptions.latex()$
\documentclass[
$for(babel-otherlangs)$
  $babel-otherlangs$,
$endfor$
$if(babel-lang)$
  $babel-lang$,
$endif$
$if(fontsize)$
  $fontsize$,
$endif$
$if(papersize)$
  $papersize$paper,
$endif$
$for(classoption)$
  $classoption$$sep$,
$endfor$
]{$documentclass$}
$if(beamerarticle)$
\usepackage{beamerarticle} % needs to be loaded first
$endif$
\usepackage{xcolor}
$if(geometry)$
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
$endif$
\usepackage{amsmath,amssymb}
$if(cancel)$
\usepackage{cancel}
$endif$
\usepackage{atkinson}
% ==================================================================================
% Code listings and table theming (listings + tabularray)
% ==================================================================================
% Listings package for code blocks (configured to use the Alabaster-inspired style below)
\usepackage{listings}
\usepackage{upquote}
\usepackage{tabularray}
\UseTblrLibrary{booktabs}

% ==================================================================================
% Define Alabaster-inspired colors
% ==================================================================================
\definecolor{alabaster-bg}{HTML}{FAFAFA} % Background color - very light gray
\definecolor{alabaster-keyword}{HTML}{C92C2C} % Keywords - red
\definecolor{alabaster-string}{HTML}{008000} % Strings - green
\definecolor{alabaster-comment}{HTML}{0078D7} % Comments - blue
\definecolor{alabaster-number}{HTML}{333333} % Line numbers - dark gray
\definecolor{alabaster-identifier}{HTML}{000000} % Identifiers - black

% Compact arrow for a single tab: compute width of four code-space characters
\newlength{\AlabasterTabWidth}
\settowidth{\AlabasterTabWidth}{{\ttfamily\footnotesize\ \ \ \ }}% width of four spaces in code font
\newcommand*\AlabasterTab{\makebox[\AlabasterTabWidth][c]{\color{BrickRed}\scriptsize\(\rightarrow\)}}% arrow for tab

% ==================================================================================
% Global Listings Settings
% ==================================================================================
\lstset{
  numbers=left,
  numberstyle=\tiny\color{alabaster-number},
  breaklines=true,
  prebreak=\space\mbox{\textcolor{green}{\(\rightarrow\)}},
  postbreak=\mbox{\textcolor{green}{\(\hookrightarrow\)\space}},
  breakatwhitespace=false,
  tabsize=4,
  showtabs=true,
  tab=\AlabasterTab,
  showstringspaces=false,
  showspaces=false,
  firstnumber=1,
  numberfirstline=true,
  stepnumber=2,
  basicstyle=\footnotesize\ttfamily\color{alabaster-identifier},
  columns=fullflexible,
  extendedchars=true,
  inputencoding=utf8,
  aboveskip=0pt, % remove extra vertical space above listings
  belowskip=0pt, % remove extra vertical space below listings
  lineskip=-0.25\baselineskip % collapse blank lines inside listings
}

% ==================================================================================
% Alabaster Style for listings
% ==================================================================================
\lstdefinestyle{Alabaster}{
  frame=lines,
  backgroundcolor=\color{alabaster-bg},
  basicstyle=\footnotesize\ttfamily\color{alabaster-identifier},
  keywordstyle=\bfseries\color{alabaster-keyword},
  identifierstyle=\color{alabaster-identifier},
  stringstyle=\color{alabaster-string},
  commentstyle=\color{alabaster-comment}\itshape,
  showtabs=true,
  belowcaptionskip=0.25em,
  abovecaptionskip=0.25em,
  aboveskip=1em,
  belowskip=0.25em,
  captionpos=b,
  rulesep=0.5em,
  framesep=3pt,
  framerule=0.4pt,
  xleftmargin=3.4pt,
  xrightmargin=3.4pt
}

% Define OpenSCAD language for listings
\lstdefinelanguage{openscad}{
  sensitive=true,
  morekeywords={module,function,if,else,for,intersection,difference,union,translate,rotate,scale,mirror,resize,render,include,use,assign,let,return,echo},
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]{"},
  morestring=[b]{'},
  keywordstyle=\color{alabaster-keyword}\bfseries,
  commentstyle=\color{alabaster-comment}\itshape,
  stringstyle=\color{alabaster-string},
}

  % PowerShell language definition (use `powershell` in fenced code blocks)
  \lstdefinelanguage{powershell}{
    sensitive=true,
    morekeywords={function,param,begin,process,end,if,else,foreach,while,return,break,continue,try,catch,finally,throw,exit},
      morecomment=[l]{\#},
    morestring=[b]{"},
    morestring=[b]{'},
    keywordstyle=\color{alabaster-keyword}\bfseries,
    commentstyle=\color{alabaster-comment}\itshape,
    stringstyle=\color{alabaster-string},
  }

  % Windows CMD / Batch language definition (use `cmd` in fenced code blocks)
  \lstdefinelanguage{cmd}{
    sensitive=false,
    morekeywords={if,else,for,call,exit,echo,set,cd,copy,del,move,ren,start,dir,type,shift,md,rd,cls},
      morecomment=[l]{REM},
    morecomment=[l]{::},
    morestring=[b]{"},
    alsoletter={@,\%},
    keywordstyle=\color{alabaster-keyword}\bfseries,
    commentstyle=\color{alabaster-comment}\itshape,
    stringstyle=\color{alabaster-string},
  }

% Ensure listings uses the Alabaster style by default
\lstset{style=Alabaster}

% ==================================================================================
% tabularray theme for longtblr tables
% ==================================================================================
\NewTblrTheme{fancy}{
  \SetTblrStyle{firsthead}{font=\bfseries}
  \SetTblrStyle{firsthead}{fg=blue2}
  \SetTblrStyle{caption-tag}{red2}
  \SetTblrStyle{width}{\linewidth}
  \SetTblrStyle{font}{\raggedright}
}

$--
$-- section numbering
$--
$if(numbersections)$
\setcounter{secnumdepth}{$if(secnumdepth)$$secnumdepth$$else$5$endif$}
$else$
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
$endif$
$fonts.latex()$
$font-settings.latex()$
$common.latex()$
$for(header-includes)$
$header-includes$
$endfor$
$after-header-includes.latex()$
$hypersetup.latex()$
$if(pdf-trailer-id)$

\ifXeTeX
\special{pdf:trailerid [ $pdf-trailer-id$ ]}
\fi
\ifPDFTeX
\pdftrailerid{}
\pdftrailer{/ID [ $pdf-trailer-id$ ]}
\fi
\ifLuaTeX
\pdfvariable trailerid {[ $pdf-trailer-id$ ]}
\fi
$endif$

$if(title)$
\title{$title$$if(thanks)$\thanks{$thanks$}$endif$}
$endif$
$if(subtitle)$
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par{}{}
}
\makeatother
\subtitle{$subtitle$}
$endif$
\author{$for(author)$$author$$sep$ \and $endfor$}
\date{$date$}

\begin{document}
$if(has-frontmatter)$
\frontmatter
$endif$
$if(abstract)$
\begin{abstract}
$abstract$
\end{abstract}
$endif$

$for(include-before)$
$include-before$

$endfor$
$if(toc)$
$if(toc-title)$
\renewcommand*\contentsname{$toc-title$}
$endif$
{
$if(colorlinks)$
$if(toccolor)$
\hypersetup{linkcolor=$toccolor$}
$endif$
$endif$
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
}
$endif$
$if(lof)$
\listoffigures
$endif$
$if(lot)$
\listoftables
$endif$
$if(linestretch)$
\setstretch{$linestretch$}
$endif$
$if(has-frontmatter)$
\mainmatter
$endif$
$body$

$if(has-frontmatter)$
\backmatter
$endif$
$if(nocite-ids)$
\nocite{$for(nocite-ids)$$it$$sep$, $endfor$}
$endif$
$if(natbib)$
$if(bibliography)$
$if(biblio-title)$
$if(has-chapters)$
\renewcommand\bibname{$biblio-title$}
$else$
\renewcommand\refname{$biblio-title$}
$endif$
$endif$
\bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}

$endif$
$endif$
$if(biblatex)$
\printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$

$endif$
$for(include-after)$
$include-after$

$endfor$
\end{document}
